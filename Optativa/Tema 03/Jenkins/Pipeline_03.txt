pipeline {
    agent any
    parameters {
        string(name:'APELLIDO', description:'Ingrese su Apellido')
        text(name:'BIOGRAFIA', description:'Ingrese su Biografía')
        booleanParam(name:'BOOLEANO', description:'Parametro Booleano')
        choice(name:'CIUDADES', choices:['Huelva','Sevilla','Córdoba','Cádiz'], description:'Selecciona una ciudad')
        password(name:'CONTRASENIA', description:'Ingrese su contraseña')
    }
    environment {
        CSA_INSTAGRAM="@csa_insta"
    }
    stages {
        stage ("Saludo 1") {
            steps {
                echo "Hola desde Saludo 1"
            }
        }
        stage ("Saludo 2") {
            steps {
                echo "Hola desde Saludo 2, paso 1"
                echo "Hola desde Saludo 2, paso 2"
            }
        }
        stage ("Imprimir variable de entorno") {
            steps {
                echo "${env.CSA_INSTAGRAM}"
                // echo "${CSA_INSTAGRAM}"
                // echo "$CSA_INSTAGRAM"
                
                sh "echo 'hola mundo'"
                sh "echo '${env.CSA_INSTAGRAM}'"
                sh "echo '${CSA_INSTAGRAM}'"
                sh "echo '$CSA_INSTAGRAM'"
            }
        }
        stage ("Imprimir variable de entorno definida en System") {
            steps {
                sh "echo '${env.JAMON}'"
                sh "echo '${JAMON}'"
                sh "echo '$JAMON'"
            }
        }
        stage ("Cambiar valor a variable de entorno definida previamente en documento Pipeline") {
            steps {
                script {
                    def temp_CSA_INSTAGRAM = "@cristobal_insta"
                    echo "${temp_CSA_INSTAGRAM}"
                    // env.CSA_INSTAGRAM = "@cristobal_insta_modificado"
                }
            }
        }
        stage ("Imprimir parametro APELLIDO") { 
            steps {
                echo "${params.APELLIDO}"
                echo "${APELLIDO}"
                // echo "$APELLIDO"
            }
        }
        stage ("Imprimir credenciales") {
            steps {
                // 1. Bloque 'withCredentials' para usuario/contraseña
                // Debe contener un bloque de pasos que se ejecuten con las credenciales
                withCredentials([usernamePassword(credentialsId:'id_de_prueba_02', usernameVariable:'CUSTOM_USER', passwordVariable:'CUSTOM_PASSWORD')]) {
                    script {
                        echo "El nombre de usuario es: $CUSTOM_USER y la contraseña es: $CUSTOM_PASSWORD"
                    }
                }
                
                // 2. Bloque 'withCredentials' para texto secreto
                // Se corrigió el error tipográfico: 'witchCredentials' -> 'withCredentials'
                withCredentials([string(credentialsId:'secret_text_jajajaja', variable:'MY_CUSTOM_SECRET')]) {
                    script {
                        echo "El valor de mi texto secreto es $MY_CUSTOM_SECRET"
                    }
                }
            }
        }
    }
}