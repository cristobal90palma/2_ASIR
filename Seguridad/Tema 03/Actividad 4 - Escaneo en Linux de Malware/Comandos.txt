Para instalar ClamAV en Debian/Ubuntu ejecuta:

# apt install clamav clamav-freshclam clamav-daemon clamdscan


Una vez instalado ClamAV lo primero que tendrás que hacer es actualizar las
 firmas de la base de datos de virus con el siguiente comando:


# freshclam

Es probable que nos salga este error:

ERROR: Failed to lock the log file /var/log/clamav/freshclam.log: Resource temporarily unavailable
ERROR: Problem with internal logger (UpdateLogFile = /var/log/clamav/freshclam.log).
ERROR: initialize: libfreshclam init failed.
ERROR: Initialization error!

Si vamos al log: /var/log/clamav/freshclam.log

Wed Nov 12 07:39:24 2025 -> --------------------------------------
Wed Nov 12 07:39:24 2025 -> daily database available for download (remote version: 27819)
Wed Nov 12 07:39:37 2025 -> daily.cvd updated (version: 27819, sigs: 2077025, f-level: 90, builder: svc.clamav-publisher)
Wed Nov 12 07:39:37 2025 -> main database available for download (remote version: 62)
Wed Nov 12 07:39:56 2025 -> main.cvd updated (version: 62, sigs: 6647427, f-level: 90, builder: sigmgr)
Wed Nov 12 07:39:56 2025 -> bytecode database available for download (remote version: 339)
Wed Nov 12 07:39:56 2025 -> bytecode.cvd updated (version: 339, sigs: 80, f-level: 90, builder: nrandolp)

Nos indica que ya hay una instancia de clamav abierta y que ya está actualizado. 
Si aún así queremos hacerla, hacemos:

sudo systemctl stop clamav-freshclam
freshclam



Vamos a crear un "malware" de prueba:

nano /var/virustest.txt

y añadimos:
X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*

Luego ejecuta el siguiente comando:

# clamscan -r -i /var/

clamscan -r -i /var/virustest.txt


root@ubuntumysqlsuarez:/home/cristobal# clamscan -r -i /var/virustest.txt
/var/virustest.txt: Eicar-Signature FOUND

----------- SCAN SUMMARY -----------
Known viruses: 8708724
Engine version: 1.4.3
Scanned directories: 0
Scanned files: 1
Infected files: 1
Data scanned: 0.00 MB
Data read: 0.00 MB (ratio 0.00:1)
Time: 32.251 sec (0 m 32 s)
Start Date: 2025:11:12 07:47:46
End Date:   2025:11:12 07:48:18
root@ubuntumysqlsuarez:/home/cristobal#




\\\\\\\\\\\\\\\\\\\\

Chkrootkit


apt update

apt install chkrootkit

chkrootkit



\\\\\\\\\\Rkhunter


Para instalar Rkhunter en Debian/Ubuntu ejecuta los siguientes comandos:

# apt update
# apt install rkhunter

Posteriormente, edita la configuración de rkhunter ejecutando el siguiente comando:

# nano /etc/rkhunter.conf

Edita las siguientes variables para que tengan estos valores:

MIRRORS_MODE=0
UPDATE_MIRRORS=1
WEB_CMD=""

El siguiente paso es actualizar las firmas:

# rkhunter --update

Para realizar un análisis ejecuta el siguiente comando:

# rkhunter -c

Hay que darle a ENTER para cada paso adicional.

All results have been written to the log file: /var/log/rkhunter.log

cat /var/log/rkhunter.log

cat /var/log/rkhunter.log > /home/cristobal/rkhunter-12112025.log


Te crea un "mail" en cat /var/mail/root


\\\\\\\\\\\\\\\\\\\\\\\\LMD – Linux Malware Detect

# cd /tmp
# wget http://www.rfxn.com/downloads/maldetect-current.tar.gz
# tar -zxvf maldetect-current.tar.gz
# cd maldetect-1.6.6/
# bash install.sh


Para ejecutar un análisis de un directorio ejecuta el siguiente comando:

# maldet -a /home

root@ubuntumysqlsuarez:/tmp/maldetect-1.6.6# maldet -a /home
Linux Malware Detect v1.6.6
            (C) 2002-2023, R-fx Networks <proj@rfxn.com>
            (C) 2023, Ryan MacDonald <ryan@rfxn.com>
This program may be freely redistributed under the terms of the GNU GPL v2

maldet(159329): {scan} signatures loaded: 17638 (14801 MD5 | 2054 HEX | 783 YARA | 0 USER)
maldet(159329): {scan} building file list for /home, this might take awhile...
maldet(159329): {scan} setting nice scheduler priorities for all operations: cpunice 19 , ionice 6
maldet(159329): {scan} file list completed in 0s, found 14 files...
maldet(159329): {scan} found clamav binary at /usr/bin/clamscan, using clamav scanner engine...
maldet(159329): {scan} scan of /home (14 files) in progress...

maldet(159329): {scan} scan completed on /home: files 14, malware hits 0, cleaned hits 0, time 27s
maldet(159329): {scan} scan report saved, to view run: maldet --report 251112-0811.159329




\\\\\\\\\\\\\\\Lynis

apt install lynis

Para realizar un análisis ejecuta:
lynis audit system


  Files:
  - Test and debug information      : /var/log/lynis.log
  - Report data                     : /var/log/lynis-report.dat
  
  

RESULTADO:

  -[ Lynis 3.0.9 Results ]-

  Warnings (3):
  ----------------------------
  ! Found one or more vulnerable packages. [PKGS-7392]
      https://cisofy.com/lynis/controls/PKGS-7392/

  ! Found some information disclosure in SMTP banner (OS or software name) [MAIL-8818]
      https://cisofy.com/lynis/controls/MAIL-8818/

  ! iptables module(s) loaded, but no rules active [FIRE-4512]
      https://cisofy.com/lynis/controls/FIRE-4512/

  Suggestions (52):
  ----------------------------
  * This release is more than 4 months old. Check the website or GitHub to see if there is an update available. [LYNIS]
      https://cisofy.com/lynis/controls/LYNIS/

  * Install libpam-tmpdir to set $TMP and $TMPDIR for PAM sessions [DEB-0280]
      https://cisofy.com/lynis/controls/DEB-0280/

  * Install apt-listbugs to display a list of critical bugs prior to each APT installation. [DEB-0810]
      https://cisofy.com/lynis/controls/DEB-0810/

  * Install apt-listchanges to display any significant changes prior to any upgrade via APT. [DEB-0811]
      https://cisofy.com/lynis/controls/DEB-0811/

  * Install fail2ban to automatically ban hosts that commit multiple authentication errors. [DEB-0880]
      https://cisofy.com/lynis/controls/DEB-0880/

  * Set a password on GRUB boot loader to prevent altering boot configuration (e.g. boot in single user mode without password) [BOOT-5122]
      https://cisofy.com/lynis/controls/BOOT-5122/

  * Consider hardening system services [BOOT-5264]
    - Details  : Run '/usr/bin/systemd-analyze security SERVICE' for each service
      https://cisofy.com/lynis/controls/BOOT-5264/

  * If not required, consider explicit disabling of core dump in /etc/security/limits.conf file [KRNL-5820]
      https://cisofy.com/lynis/controls/KRNL-5820/

  * Check PAM configuration, add rounds if applicable and expire passwords to encrypt with new values [AUTH-9229]
      https://cisofy.com/lynis/controls/AUTH-9229/

  * Configure password hashing rounds in /etc/login.defs [AUTH-9230]
      https://cisofy.com/lynis/controls/AUTH-9230/

  * Look at the locked accounts and consider removing them [AUTH-9284]
      https://cisofy.com/lynis/controls/AUTH-9284/

  * Delete accounts which are no longer used [AUTH-9288]
      https://cisofy.com/lynis/controls/AUTH-9288/

  * Default umask in /etc/login.defs could be more strict like 027 [AUTH-9328]
      https://cisofy.com/lynis/controls/AUTH-9328/

  * To decrease the impact of a full /home file system, place /home on a separate partition [FILE-6310]
      https://cisofy.com/lynis/controls/FILE-6310/

  * To decrease the impact of a full /tmp file system, place /tmp on a separate partition [FILE-6310]
      https://cisofy.com/lynis/controls/FILE-6310/

  * To decrease the impact of a full /var file system, place /var on a separate partition [FILE-6310]
      https://cisofy.com/lynis/controls/FILE-6310/

  * Disable drivers like USB storage when not used, to prevent unauthorized storage or data theft [USB-1000]
      https://cisofy.com/lynis/controls/USB-1000/

  * Check DNS configuration for the dns domain name [NAME-4028]
      https://cisofy.com/lynis/controls/NAME-4028/

  * Purge old/removed packages (3 found) with aptitude purge or dpkg --purge command. This will cleanup old configuration files, cron jobs and startup scripts. [PKGS-7346]
      https://cisofy.com/lynis/controls/PKGS-7346/

  * Install debsums utility for the verification of packages with known good database. [PKGS-7370]
      https://cisofy.com/lynis/controls/PKGS-7370/

  * Update your system with apt-get update, apt-get upgrade, apt-get dist-upgrade and/or unattended-upgrades [PKGS-7392]
      https://cisofy.com/lynis/controls/PKGS-7392/

  * Install package apt-show-versions for patch management purposes [PKGS-7394]
      https://cisofy.com/lynis/controls/PKGS-7394/

  * Determine if protocol 'dccp' is really needed on this system [NETW-3200]
      https://cisofy.com/lynis/controls/NETW-3200/

  * Determine if protocol 'sctp' is really needed on this system [NETW-3200]
      https://cisofy.com/lynis/controls/NETW-3200/

  * Determine if protocol 'rds' is really needed on this system [NETW-3200]
      https://cisofy.com/lynis/controls/NETW-3200/

  * Determine if protocol 'tipc' is really needed on this system [NETW-3200]
      https://cisofy.com/lynis/controls/NETW-3200/

  * You are advised to hide the mail_name (option: smtpd_banner) from your postfix configuration. Use postconf -e or change your main.cf file (/etc/postfix/main.cf) [MAIL-8818]
      https://cisofy.com/lynis/controls/MAIL-8818/

  * Disable the 'VRFY' command [MAIL-8820:disable_vrfy_command]
    - Details  : disable_vrfy_command=no
    - Solution : run postconf -e disable_vrfy_command=yes to change the value
      https://cisofy.com/lynis/controls/MAIL-8820/

  * Install Apache mod_evasive to guard webserver against DoS/brute force attempts [HTTP-6640]
      https://cisofy.com/lynis/controls/HTTP-6640/

  * Install Apache modsecurity to guard webserver against web application attacks [HTTP-6643]
      https://cisofy.com/lynis/controls/HTTP-6643/

  * Consider hardening SSH configuration [SSH-7408]
    - Details  : AllowTcpForwarding (set YES to NO)
      https://cisofy.com/lynis/controls/SSH-7408/

  * Consider hardening SSH configuration [SSH-7408]
    - Details  : ClientAliveCountMax (set 3 to 2)
      https://cisofy.com/lynis/controls/SSH-7408/

  * Consider hardening SSH configuration [SSH-7408]
    - Details  : LogLevel (set INFO to VERBOSE)
      https://cisofy.com/lynis/controls/SSH-7408/

  * Consider hardening SSH configuration [SSH-7408]
    - Details  : MaxAuthTries (set 6 to 3)
      https://cisofy.com/lynis/controls/SSH-7408/

  * Consider hardening SSH configuration [SSH-7408]
    - Details  : MaxSessions (set 10 to 2)
      https://cisofy.com/lynis/controls/SSH-7408/

  * Consider hardening SSH configuration [SSH-7408]
    - Details  : PermitRootLogin (set YES to (FORCED-COMMANDS-ONLY|NO|PROHIBIT-PASSWORD|WITHOUT-PASSWORD))
      https://cisofy.com/lynis/controls/SSH-7408/

  * Consider hardening SSH configuration [SSH-7408]
    - Details  : Port (set 22 to )
      https://cisofy.com/lynis/controls/SSH-7408/

  * Consider hardening SSH configuration [SSH-7408]
    - Details  : TCPKeepAlive (set YES to NO)
      https://cisofy.com/lynis/controls/SSH-7408/

  * Consider hardening SSH configuration [SSH-7408]
    - Details  : X11Forwarding (set YES to NO)
      https://cisofy.com/lynis/controls/SSH-7408/

  * Consider hardening SSH configuration [SSH-7408]
    - Details  : AllowAgentForwarding (set YES to NO)
      https://cisofy.com/lynis/controls/SSH-7408/

  * Enable logging to an external logging host for archiving purposes and additional protection [LOGG-2154]
      https://cisofy.com/lynis/controls/LOGG-2154/

  * Add a legal banner to /etc/issue, to warn unauthorized users [BANN-7126]
      https://cisofy.com/lynis/controls/BANN-7126/

  * Add legal banner to /etc/issue.net, to warn unauthorized users [BANN-7130]
      https://cisofy.com/lynis/controls/BANN-7130/

  * Enable process accounting [ACCT-9622]
      https://cisofy.com/lynis/controls/ACCT-9622/

  * Enable sysstat to collect accounting (disabled) [ACCT-9626]
      https://cisofy.com/lynis/controls/ACCT-9626/

  * Enable auditd to collect audit information [ACCT-9628]
      https://cisofy.com/lynis/controls/ACCT-9628/

  * Install a file integrity tool to monitor changes to critical and sensitive files [FINT-4350]
      https://cisofy.com/lynis/controls/FINT-4350/

  * Determine if automation tools are present for system management [TOOL-5002]
      https://cisofy.com/lynis/controls/TOOL-5002/

  * Consider restricting file permissions [FILE-7524]
    - Details  : See screen output or log file
    - Solution : Use chmod to change file permissions
      https://cisofy.com/lynis/controls/FILE-7524/

  * Double check the permissions of home directories as some might be not strict enough. [HOME-9304]
      https://cisofy.com/lynis/controls/HOME-9304/

  * One or more sysctl values differ from the scan profile and could be tweaked [KRNL-6000]
    - Solution : Change sysctl value or disable test (skip-test=KRNL-6000:<sysctl-key>)
      https://cisofy.com/lynis/controls/KRNL-6000/

  * Harden compilers like restricting access to root user only [HRDN-7222]
      https://cisofy.com/lynis/controls/HRDN-7222/

  Follow-up:
  ----------------------------
  - Show details of a test (lynis show details TEST-ID)
  - Check the logfile for all details (less /var/log/lynis.log)
  - Read security controls texts (https://cisofy.com)
  - Use --upload to upload data to central system (Lynis Enterprise users)

================================================================================

  Lynis security scan details:

  Hardening index : 57 [###########         ]
  Tests performed : 269
  Plugins enabled : 1

  Components:
  - Firewall               [V]
  - Malware scanner        [V]

  Scan mode:
  Normal [V]  Forensics [ ]  Integration [ ]  Pentest [ ]

  Lynis modules:
  - Compliance status      [?]
  - Security audit         [V]
  - Vulnerability scan     [V]

  Files:
  - Test and debug information      : /var/log/lynis.log
  - Report data                     : /var/log/lynis-report.dat

================================================================================

  Lynis 3.0.9

  Auditing, system hardening, and compliance for UNIX-based systems
  (Linux, macOS, BSD, and others)

  2007-2021, CISOfy - https://cisofy.com/lynis/
  Enterprise support available (compliance, plugins, interface and tools)

================================================================================

  [TIP]: Enhance Lynis audits by adding your settings to custom.prf (see /etc/lynis/default.prf for all settings)
  
  
  
  
  
  
  
  
  \\\\\\\\\\\\\\\\\\\PHP-Antimalware-Scanner
  
  Para utilizarlo, puedes simplemente descargarlo:

# wget https://raw.githubusercontent.com/marcocesarato/PHP-Antimalware-Scanner/master/dist/scanner

Y ejecutarlo con un CLI de PHP:

# php scanner /ruta/directorio/web/ --auto-skip --all

php scanner /var/www/html/ --auto-skip --all


Files scanned: 245
Files edited: 0
Files quarantined: 0
Files whitelisted: 0
Files ignored: 8

Malware detected: 8
Malware removed: 0

Files ignored:
/var/www/html/biblioteca/.git/hooks/pre-commit.sample
/var/www/html/biblioteca/Assets/js/vfs_fonts.js
/var/www/html/biblioteca/Assets/js/pace.min.js
/var/www/html/biblioteca/Assets/js/pdfmake.min.js
/var/www/html/biblioteca/Views/Usuarios/index.php
/var/www/html/biblioteca/Views/index.php
/var/www/html/biblioteca/Models/UsuariosModel.php
/var/www/html/biblioteca/Controllers/Usuarios.php


https://gemini.google.com/app/1255b9970aa063e5

While the eval() alert is a false positive



Explanation

    Line 54 is not using eval(): This line is simply assigning the POST variable clave (which means "password" or "key" in Spanish) to a PHP variable named $clave, after running it through a sanitization function strClean().

    The Scanner Interpreted clave as eval: The scanner likely uses a weak string matching heuristic or simple obfuscation detection logic. It seems to have looked at the variable name $clave and incorrectly matched it to the string eval.

        c + lave ≈ eval (This is purely speculative but points to a flawed signature).

        Alternatively, some scanners look for patterns that could be used for obfuscation, like a sequence of letters that, when combined or manipulated, form a known malicious function like eval, base64_decode, or assert.

Conclusion: Based on the provided code preview, there is no clear malicious intent or use of the dangerous eval() function in the Usuarios.php file. The alert appears to be a False Positive due to the scanner's aggressive or flawed pattern matching.