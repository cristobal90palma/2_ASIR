<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guía ProFTPD - Proxmox</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f7f6;
        }
        header {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h2 {
            color: #2980b9;
            border-bottom: 2px solid #2980b9;
            padding-bottom: 10px;
            margin-top: 40px;
        }
        h3 {
            color: #16a085;
            margin-top: 25px;
        }
        pre {
            background-color: #2d3436;
            color: #fab1a0;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 0.9em;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        code {
            font-family: 'Courier New', Courier, monospace;
        }
        .comment {
            color: #636e72;
            font-style: italic;
        }
        .important {
            background-color: #dfe6e9;
            border-left: 5px solid #d63031;
            padding: 15px;
            margin: 20px 0;
        }
        .step-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        table, th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #2980b9;
            color: white;
        }
    </style>
</head>
<body>

<header>
    <h1>GUÍA COMPLETA DE COMANDOS PARA EXAMEN PROFTPD</h1>
    <p>Referencia para entornos Proxmox / Debian</p>
</header>

<section class="step-box">
    <h2>PASO 1: INSTALACIÓN Y PREPARACIÓN</h2>
    <p>Actualización de repositorios e instalación de módulos de criptografía y cuotas.</p>
    <pre><code><span class="comment"># 1. Instalar paquetes</span>
apt update && apt install proftpd-basic proftpd-mod-crypto proftpd-mod-quotatab-file -y

<span class="comment"># 2. Configurar IP secundaria (.222)</span>
ip addr add 10.2.35.222/24 dev eth0

<span class="comment"># 3. Estructura de Logs</span>
mkdir -p /var/log/proftpd
touch /var/log/proftpd/xferlog
touch /var/log/proftpd/proftpd.log
chown -R proftpd:root /var/log/proftpd</code></pre>
</section>

<section class="step-box">
    <h2>PASO 2: CREACIÓN DE USUARIOS (SISTEMA)</h2>
    <pre><code><span class="comment"># Usuarios reales y de seguridad</span>
useradd -m -s /bin/false reig
useradd -m -s /bin/bash tormenta
echo "tormenta:password123" | chpasswd

<span class="comment"># Bloqueos (Magneto, Mística y Villanos)</span>
useradd -m magneto
useradd -m mistica
groupadd villanos
useradd -m -g villanos veneno

<span class="comment"># Anónimos y Virtual Host</span>
useradd -d /srv/px -s /bin/false profesorx
useradd -m gandalf
useradd -d /srv/abismo -s /bin/false balrog

<span class="comment"># Permisos carpetas</span>
mkdir -p /srv/abismo/uploads /srv/abismo/mordor
chown -R balrog:nogroup /srv/abismo
chmod 777 /srv/abismo/uploads</code></pre>
</section>

<section class="step-box">
    <h2>PASO 3: USUARIOS VIRTUALES (LOBEZNO)</h2>
    <pre><code>mkdir -p /srv/xmen

<span class="comment"># Crear grupo virtual (GID 2001)</span>
ftpasswd --group --name=xmen --gid=2001 --file=/etc/proftpd/ftpd.group

<span class="comment"># Crear usuario virtual</span>
ftpasswd --passwd --name=lobezno --uid=2001 --gid=2001 --home=/srv/xmen --shell=/bin/false --file=/etc/proftpd/ftpd.passwd --stdin

chown -R 2001:2001 /srv/xmen
chmod 440 /etc/proftpd/ftpd.passwd /etc/proftpd/ftpd.group</code></pre>
</section>

<section class="step-box">
    <h2>PASO 4: CONFIGURACIÓN DE CUOTAS</h2>
    <pre><code><span class="comment"># 1. Crear tablas</span>
ftpquota --create-table --type=limit --table-path=/etc/proftpd/ftpquota.limittab
ftpquota --create-table --type=tally --table-path=/etc/proftpd/ftpquota.tallytab

<span class="comment"># 2. Definir límites (50GB Up / 1000GB Down)</span>
ftpquota --add-record --type=limit --name=tormenta --quota-type=user \
  --bytes-upload=53687091200 --bytes-download=1073741824000 \
  --files-upload=50 --files-download=1000 \
  --table-path=/etc/proftpd/ftpquota.limittab

<span class="comment"># 3. Inicializar contador</span>
ftpquota --add-record --type=tally --name=tormenta --quota-type=user \
  --bytes-upload=0 --bytes-download=0 --files-upload=0 --files-download=0 \
  --table-path=/etc/proftpd/ftpquota.tallytab</code></pre>
</section>

<section class="step-box">
    <h2>PASO 5: CERTIFICADOS TLS/SSL</h2>
    <pre><code>mkdir -p /etc/proftpd/ssl
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout /etc/proftpd/ssl/proftpd.key.pem \
  -out /etc/proftpd/ssl/proftpd.cert.pem \
  -subj "/C=ES/ST=Alicante/L=Alicante/O=IT/CN=ftp.examen"</code></pre>
</section>

<section class="step-box">
    <h2>PASO 6: CONFIGURACIÓN <code>proftpd.conf</code></h2>
    <p>Se recomienda limpiar el archivo y pegar la configuración estructurada:</p>
    <pre><code>Include /etc/proftpd/modules.conf

ServerName "Servidor Examen"
DefaultServer on
AuthOrder mod_auth_file.c mod_auth_unix.c
AuthUserFile /etc/proftpd/ftpd.passwd
AuthGroupFile /etc/proftpd/ftpd.group
DefaultRoot ~

&lt;Limit LOGIN&gt;
    DenyUser magneto
    DenyUser mistica
    DenyGroup villanos
&lt;/Limit&gt;

<span class="comment"># Pasivo para WinSCP</span>
PassivePorts 49152 49200

&lt;IfModule mod_tls.c&gt;
    TLSEngine on
    TLSRequired on
    TLSRSACertificateFile /etc/proftpd/ssl/proftpd.cert.pem
    TLSRSACertificateKeyFile /etc/proftpd/ssl/proftpd.key.pem
    TLSOptions NoSessionReuseRequired
&lt;/IfModule&gt;

<span class="comment"># VirtualHost .222</span>
&lt;VirtualHost 10.2.35.222&gt;
    ServerName "ftp.lordoftherings.tv"
    &lt;Limit LOGIN&gt;
        AllowUser gandalf
        DenyAll
    &lt;/Limit&gt;
&lt;/VirtualHost&gt;</code></pre>
</section>

<section class="step-box">
    <h2>PASO 7: VALIDACIÓN Y LOGS</h2>
    <pre><code><span class="comment"># Testear sintaxis</span>
proftpd -t

<span class="comment"># Reiniciar</span>
systemctl restart proftpd

<span class="comment"># Ver Cuotas de Tormenta</span>
ftpquota --show-records --type=limit --table-path=/etc/proftpd/ftpquota.limittab
ftpquota --show-records --type=tally --table-path=/etc/proftpd/ftpquota.tallytab</code></pre>
</section>

<footer style="text-align: center; margin-top: 50px; font-size: 0.8em; color: #7f8c8d;">
    Guía de Examen ProFTPD - Generado para propósitos educativos.
</footer>

</body>
</html>